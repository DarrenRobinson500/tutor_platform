import json
import os
from backend.models import Skill


def import_skill_tree(node, parent=None):
    """Recursively create Skill objects from a nested JSON structure."""

    # Convert years_practised list â†’ comma-separated string for the model
    years = node.get("years_practised", [])
    grades_str = ",".join(str(y) for y in years)
    print(node["description"])

    skill = Skill.objects.create(
        parent=parent,
        code=node["code"],
        description=node["description"],
        grades=grades_str,
    )

    # Recurse into children
    for child in node.get("children", []):
        import_skill_tree(child, parent=skill)


def import_syllabus():
    base_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
    json_path = os.path.join(base_dir, "nsw_math_k10_years.json")

    # Load the JSON file
    with open(json_path, "r", encoding="utf-8") as f:
        data = json.load(f)

    # Import each top-level skill
    for top in data:
        import_skill_tree(top)